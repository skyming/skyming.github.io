
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>带边框的UIImage缩放 - OneV's Den</title>
	<meta name="author" content="onevcat">

	
	<meta name="description" content="Dec 21st, 2011 带边框的UIImage缩放 一个带边框的UIImage如果使用常规的缩放，边框部分将被按照缩放比例拉伸或压缩，有些时候这并不是我们所期望的..比如这个边框是根据图片大小变化的外框。比如下面的类似按钮的不明物体图片：主体为渐变蓝色，边框为外圈白色，灰色底板为背景。 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="OneV's Den" type="application/atom+xml">
	
	<link rel="canonical" href="http://onevcat.com/2011/12/uiimage/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script type="text/javascript">var switchTo5x=false;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "496dac80-40ba-487b-b557-af2d3629eb28", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("onev@onevcat.com") + "?s=160' alt='Profile Picture' style='width: 160px;'");
	</script>
</div>
<h1><a href="/">OneV's Den</a></h1>
<p class="subtitle">上善若水，人淡如菊</p>
<p class="subtitle">iOS/Mac，Unity3D开发者，现就职于日本创意公司Kayac，正在修行，探求创意之源</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/aboutme/" target="_blank">关于我</a></li>
  <li><a href="/blog/archives">全部文章</a></li>
  <li><a href="http://project.onevcat.com">我的项目</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id791903475?ls=1&mt=8">	Fanche Do - 番茄工作法工具</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id562520527?ls=1&mt=8">	Our Money - 多人同步记账</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id646243166?ls=1&mt=8">	Volume Recorder - 音量录音机</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/onevcat" title="Sina Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/onevcat" title="Facebook">Facebook</a>
		
		
		<a class="google" href="https://plus.google.com/107108267983477358170" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/onevcat" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/onevcat" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<a href="http://eepurl.com/wNSkj"><script type="text/javascript" language="JavaScript" src="http://onevcat.us5.list-manage.com/subscriber-count?b=32&u=3244d6df-04b2-4c3b-bfb2-06ac1dd40a00&id=cfde66e507"></script></a>

<script type="text/javascript" src="/javascripts/open-in-blank.js"></script>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-12-21T00:00:00+09:00" data-updated="true" itemprop="datePublished">Dec 21<span>st</span>, 2011</time></div>
	</div>
	<h1 class="title" itemprop="name">带边框的UIImage缩放</h1>
	<div class="entry-content" itemprop="articleBody"><p><!--:zh--><a href="http://www.onevcat.com/wp-content/uploads/2011/12/3063712_114121013911_2.jpg"><img class="aligncenter size-full wp-image-429" title="3063712_114121013911_2" src="http://www.onevcat.com/wp-content/uploads/2011/12/3063712_114121013911_2-e1324476057897.jpg" alt="" width="1024" height="256" /></a>一个带边框的UIImage如果使用常规的缩放，边框部分将被按照缩放比例拉伸或压缩，有些时候这并不是我们所期望的..比如这个边框是根据图片大小变化的外框。比如下面的类似按钮的不明物体图片：主体为渐变蓝色，边框为外圈白色，灰色底板为背景。<!--:--><!--:en--><a href="http://www.onevcat.com/wp-content/uploads/2011/12/3063712_114121013911_2-e1324476057897.jpg"><img class="aligncenter size-full wp-image-429" title="3063712_114121013911_2" src="http://www.onevcat.com/wp-content/uploads/2011/12/3063712_114121013911_2-e1324476057897.jpg" alt="" width="1024" height="256" /></a>Origin post can be found <a href="http://iphonedevelopertips.com/user-interface/ios-5-uiimage-and-resizableimagewithcapinsets.html">here</a>.</p>




<p>I recently began writing a short example to learn more about the iOS 5 Appearance API and customizing <strong>UINavigationBar</strong> objects. The goal was to add a custom background, title and text to the navbar. Once I had this working, to keep a consist look across my application, I began tweaking the buttons on the navbar using the same Appearance API.<!--:--><!--more--><!--:zh--></p>




<p><img class="alignnone size-full wp-image-10771" title="blueButton" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/blueButton.gif" alt="" width="121" height="60" /></p>




<p>常见的按钮添加和背景设置如下：</p>




<p>[crayon]<br />
UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(80, 130, 160, 44)];<br />
[button setTitle:@&#8221;Test Button&#8221; forState:UIControlStateNormal];</p>




<p>// Image with without cap insets<br />
UIImage *buttonImage = [UIImage imageNamed:@&#8221;blueButton&#8221;];</p>




<p>[button addTarget:self action:@selector(buttonPressed:) forControlEvents: UIControlEventTouchUpInside];<br />
[button setBackgroundImage:buttonImage forState:UIControlStateNormal];<br />
[[self view] addSubview:button];<br />
[/crayon]</p>




<p>所得到的按钮会相当悲剧&#8230;</p>




<p><img class="alignnone size-full wp-image-10767" title="button0" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/button0.gif" alt="" width="238" height="76" /></p>




<p>边框，特别是左右边框由于按钮frame过大被惨烈拉伸&#8230;</p>




<p>iOS5中提供了一个新的UIImage方法，<a href="http://developer.apple.com/library/IOs/#documentation/UIKit/Reference/UIImage_Class/Reference/Reference.html">resizableImageWithCapInsets:</a>，可以将图片转换为以某一偏移值为偏移的可伸缩图像（偏移值内的图像将不被拉伸或压缩）。</p>




<p>用法引述如下：
<blockquote>
<h3 id="jumpTo_32">resizableImageWithCapInsets:</h3>
Creates and returns a new image object with the specified cap insets.
<div>- (UIImage *)resizableImageWithCapInsets:(UIEdgeInsets)<em>capInsets</em></div>
<div>
<h5>Parameters</h5>
<dl><dt><em>capInsets</em></dt><dd>The values to use for the cap insets.</dd></dl></div></blockquote></p>




<p>
<div>
<h5>Return Value</h5>
A new image object with the specified cap insets.</div></p>




<p>
<div>
<h5>Discussion</h5>
You use this method to add cap insets to an image or to change the existing cap insets of an image. In both cases, you get back a new image and the original image remains untouched.</div></p>




<p>During scaling or resizing of the image, areas covered by a cap are not scaled or resized. Instead, the pixel area not covered by the cap in each direction is tiled, left-to-right and top-to-bottom, to resize the image. This technique is often used to create variable-width buttons, which retain the same rounded corners but whose center region grows or shrinks as needed. For best performance, use a tiled area that is a <code>1x1</code> pixel area in size.</p>




<p>
<div /></p>




<p>输入参数为一个capInsets结构体：
<blockquote>Defines inset distances for views.</blockquote></p>




<p>typedef struct {<br />
CGFloat top, left, bottom, right;<br />
} UIEdgeInsets;
分别表示上左下右四个方向的偏移量。于是把上面按钮的UIImage改为如下形式：<br />
[crayon]<br />
// Image with cap insets<br />
UIImage *buttonImage = [[UIImage imageNamed:@&#8221;blueButton&#8221;]<br />
resizableImageWithCapInsets:UIEdgeInsetsMake(0, 16, 0, 16)];<br />
[/crayon]<br />
可以得到如下按钮：</p>




<p><img class="alignnone size-full wp-image-10768" title="button1" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/button1.gif" alt="" width="239" height="76" /></p>




<p>问题得到解决。</p>




<p>但是值得注意的是该方法需要至少iOS5的运行环境，因此对于需要开发支持iOS5之前的App来说是不可行的。替代方案是<a href="http://developer.apple.com/library/IOs/#documentation/UIKit/Reference/UIImage_Class/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/occ/instm/UIImage/stretchableImageWithLeftCapWidth:topCapHeight:">stretchableImageWithLeftCapWidth:topCapHeight:</a>，但是在iOS5中，这已经是被Deprecated的方法了，而且该方法只能以1px作为重复铺满拉伸区域，无法做到类似渐变等图片效果，是存在一定局限的。</p>




<p><!--:--><!--:en--></p>




<p>As I got further into the customization of the buttons, I ran into a method within <strong>UIImage</strong> that was introduced in iOS 5, <strong>resizableImageWithCapInsets</strong>. I found myself getting side-tracked from the original idea of navbar look and feel, to understanding how cap insets work. This post delves into what I learned.
<h5>Cap Insets with UIButton</h5>
As the documentation describes, you use <strong>resizableImageWithCapInsets</strong> to add cap insets to an image, when the image is resized or scaled, cap areas are not affected. The best way to understand this is through an example.</p>




<p>Let’s assume I want all the buttons on my UI to have a similar look, a gradient with a white border. Below is the image used for the examples in this post (the button is shown on a gray backdrop so you can see the white border):</p>




<p><img title="blueButton" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/blueButton.gif" alt="" width="121" height="60" /></p>




<p>Depending on the context of where the button appears, its size may vary. The code to create a button with the image and the corresponding output follow:
<div>
<div>[crayon]<br />
UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(80, 130, 160, 44)];<br />
[button setTitle:@&#8221;Test Button&#8221; forState:UIControlStateNormal];// Image with without cap insets<br />
UIImage *buttonImage = [UIImage imageNamed:@&#8221;blueButton&#8221;];[button addTarget:self action:@selector(buttonPressed:) forControlEvents: UIControlEventTouchUpInside];<br />
[button setBackgroundImage:buttonImage forState:UIControlStateNormal];<br />
[[self view] addSubview:button];<br />
[/crayon]</div>
</div>
<img title="button0" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/button0.gif" alt="" width="238" height="76" /></p>




<p>As you can see, the button is stretched in all directions. Let’s change the code to include cap insets, however, before we do that, let’s look at the signature of the cap insets method:</p>




<p>- (UIImage *)resizableImageWithCapInsets:(UIEdgeInsets)capInsets</p>




<p>Looking on step further, <strong>UIEdgeInserts</strong> is defined as:
<div>
<div>
<pre>typedef struct {
   CGFloat top, left, bottom, right;
} UIEdgeInsets;</pre>
</div>
</div>
<strong>UIEdgeInsets</strong> is structure that specifies float values for each cap inset: top, left, bottom and right areas of an image. To apply this to the image for the button, here is all we need to do:
<div>
<div>[crayon]<br />
// Image with cap insets<br />
UIImage *buttonImage = [[UIImage imageNamed:@&#8221;blueButton&#8221;]<br />
resizableImageWithCapInsets:UIEdgeInsetsMake(0, 16, 0, 16)];<br />
[/crayon]</div>
</div>
This requests that the left and right 16 pixels of the original image are not scaled or resized when stretching the image to accomodate the button size frame defined above. The end results is as shown below:</p>




<p><img title="button1" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/button1.gif" alt="" width="239" height="76" />
<h5>Cap Insets with UIBarButtonItem</h5>
We can use the same image for a button on a navbar (I’ll show the specifics in the next post on customizing the navbar). Without specifying the cap insets, the button looks as follows:</p>




<p><img title="backButton0" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/backButton0.gif" alt="" width="340" height="80" /></p>




<p>The code below specifies an image where 12 pixels on the top, left, bottom and right be preserved when stretching/resizing the button:
<div>
<div>[crayon]UIImage *backButton = [[UIImage imageNamed:@&#8221;blueButton&#8221;]<br />
resizableImageWithCapInsets:UIEdgeInsetsMake(12, 12, 12, 12)];<br />
[/crayon]</div>
</div>
The output nows looks as follows:</p>




<p><img title="backButton1" src="http://iphonedevelopertips.com/wp-content/uploads/2011/12/backButton1.gif" alt="" width="340" height="80" /></p>

</div>

</article>

	<div class="share">
	如果您觉得这篇文章对您有帮助，请不吝分享让更多人知道 :)
	<span class='st_sina_large' displayText='Sina'></span>
	<span class='st_facebook_large' displayText='Facebook'></span>
	<span class='st_twitter_large' displayText='Tweet'></span>
	<span class='st_email_large' displayText='Email'></span>
	<span class='st_sharethis_large' displayText='ShareThis'></span>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
	<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/80x15.png" /></a>本站点采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh">知识共享署名-非商业性使用 3.0 国际版本许可协议</a>进行许可
</p>
<p>
  2014 - <a href="http://about.me/onevcat">@onevcat</a>  
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>  <span class="credit"> 感谢<a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a>为本站提供稳定的VPS服务</span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'onevcat';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://onevcat.com/2011/12/uiimage/';
        var disqus_url = 'http://onevcat.com/2011/12/uiimage/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-25719337-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
