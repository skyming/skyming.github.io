
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>OneV's Den</title>
	<meta name="author" content="onevcat">

	
	<meta name="description" content="Dec 3rd, 2011 能工巧匠集 Objective-C中的Debug表达式 有程序的地方就有bug，有bug的地方就需要debug。对于程序员来说，coding的过程便是制造bug和解决bug。Objective定义了不少表达式来协助debug的流程，将这些表达式用在NSLog中， &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="OneV's Den" type="application/atom+xml">
	
	<link rel="canonical" href="http://onevcat.com/page/8/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script type="text/javascript">var switchTo5x=false;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "496dac80-40ba-487b-b557-af2d3629eb28", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("onev@onevcat.com") + "?s=160' alt='Profile Picture' style='width: 160px;'");
	</script>
</div>
<h1><a href="/">OneV's Den</a></h1>
<p class="subtitle">上善若水，人淡如菊</p>
<p class="subtitle">iOS/Mac，Unity3D开发者，现就职于日本创意公司Kayac，正在修行，探求创意之源</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/aboutme/" target="_blank">关于我</a></li>
  <li><a href="/blog/archives">全部文章</a></li>
  <li><a href="http://project.onevcat.com">我的项目</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id791903475?ls=1&mt=8">	Fanche Do - 番茄工作法工具</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id562520527?ls=1&mt=8">	Our Money - 多人同步记账</a></li>
  <li><a href="https://itunes.apple.com/cn/app/id646243166?ls=1&mt=8">	Volume Recorder - 音量录音机</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/onevcat" title="Sina Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/onevcat" title="Facebook">Facebook</a>
		
		
		<a class="google" href="https://plus.google.com/107108267983477358170" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/onevcat" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/onevcat" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<a href="http://eepurl.com/wNSkj"><script type="text/javascript" language="JavaScript" src="http://onevcat.us5.list-manage.com/subscriber-count?b=32&u=3244d6df-04b2-4c3b-bfb2-06ac1dd40a00&id=cfde66e507"></script></a>

<script type="text/javascript" src="/javascripts/open-in-blank.js"></script>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-12-03T00:00:00+09:00" data-updated="true" itemprop="datePublished">Dec 3<span>rd</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/neng-gong-qiao-jiang-ji/'>能工巧匠集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/12/debug-2/" itemprop="url">Objective-C中的Debug表达式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://www.onevcat.com/wp-content/uploads/2011/12/bug.jpg"><img class="aligncenter size-full wp-image-361" title="bug" src="http://www.onevcat.com/wp-content/uploads/2011/12/bug-e1322843013224.jpg" alt="" width="1280" height="291" /></a>有程序的地方就有bug，有bug的地方就需要debug。对于程序员来说，coding的过程便是制造bug和解决bug。Objective定义了不少表达式来协助debug的流程，将这些表达式用在NSLog中，可以简化部分工作，快速定义到debug的部分。

		
		<a href="/2011/12/debug-2/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-11-30T00:00:00+09:00" data-updated="true" itemprop="datePublished">Nov 30<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/neng-gong-qiao-jiang-ji/'>能工巧匠集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/11/nsurl/" itemprop="url">关于NSURL的解析和编码</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/11/nsurl.png"><img class="aligncenter size-full wp-image-328" title="nsurl" src="http://www.onevcat.com/wp-content/uploads/2011/11/nsurl.png" alt="" width="715" height="133" /></a>NSURL毫无疑问是常用类，有时候我们需要对一个url进行分析整理，当然是可以按照RFC 1808的定义去自己分析，但是万能的Apple大大已经在SDK里扔了不少方法来帮助解析一个url了&#8230;方便又快捷呐～比如下面的输入：</p>
<p style="text-align: justify;">
		
		<a href="/2011/11/nsurl/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-11-27T00:00:00+09:00" data-updated="true" itemprop="datePublished">Nov 27<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/hu-yan-luan-yu-ji/'>胡言乱语集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/11/kayac/" itemprop="url">尘埃落定，下一站Kayac</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><!--:zh--><p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png"><img class="aligncenter size-full wp-image-316" title="kayac" src="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png" alt="" width="598" height="124" data-pinit="registered" /></a><span style="color: #ff0000;"><em><strong>AHRP2012秋季项目已经结束，春季项目博主可以以内定者的身份进行内推，具体可以参看<a href="http://www.onevcat.com/2012/01/ahrp2012/"><span style="color: #ff0000;">这篇帖子</span></a>。</strong></em></span></p>
<p style="text-align: justify;">从10月初开始到现在，一个多月的求职尘埃落定，没有意外的话我明年将在日本镰仓(<span>Kamakura</span>)的Kayac公司开始自己的职业生涯。回顾这一个多月来的心情沉浮，颇有收获：从一开始的国内公司连连被拒，到之后几近看到出路，到最后寻找到Kayac，一路过来似乎有些宿命的感觉，而在一次又一次的笔试面试谈话中，确实渐渐看清了今后的道路和心中的诉求。这一个多月里，思考了很多人生的问题，整个人成熟了不少。<!--:--><!--:en--></p>
<p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png"><img class="aligncenter size-full wp-image-316" title="kayac" src="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png" alt="" width="598" height="124" data-pinit="registered" /></a>从10月初开始到现在，一个多月的求职尘埃落定，没有意外的话我明年将在日本镰仓(<span>Kamakura</span>)的Kayac公司开始自己的职业生涯。回顾这一个多月来的心情沉浮，颇有收获：从一开始的国内公司连连被拒，到之后几近看到出路，到最后寻找到Kayac，一路过来似乎有些宿命的感觉，而在一次又一次的笔试面试谈话中，确实渐渐看清了今后的道路和心中的诉求。这一个多月里，思考了很多人生的问题，整个人成熟了不少。<!--:--><!--:ja--></p>
<p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png"><img class="aligncenter size-full wp-image-316" title="kayac" src="http://www.onevcat.com/wp-content/uploads/2011/11/kayac.png" alt="" width="598" height="124" data-pinit="registered" /></a>从10月初开始到现在，一个多月的求职尘埃落定，没有意外的话我明年将在日本镰仓(<span>Kamakura</span>)的Kayac公司开始自己的职业生涯。回顾这一个多月来的心情沉浮，颇有收获：从一开始的国内公司连连被拒，到之后几近看到出路，到最后寻找到Kayac，一路过来似乎有些宿命的感觉，而在一次又一次的笔试面试谈话中，确实渐渐看清了今后的道路和心中的诉求。这一个多月里，思考了很多人生的问题，整个人成熟了不少。<!--:-->
		
		<a href="/2011/11/kayac/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-11-26T00:00:00+09:00" data-updated="true" itemprop="datePublished">Nov 26<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/neng-gong-qiao-jiang-ji/'>能工巧匠集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/11/debug/" itemprop="url">Xcode4.2的debug小技巧</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://www.onevcat.com/wp-content/uploads/2011/11/debug1.png"><img class="aligncenter size-full wp-image-308" title="debug" src="http://www.onevcat.com/wp-content/uploads/2011/11/debug1.png" alt="" width="826" height="158" /></a><a href="http://en.wikipedia.org/wiki/Gdb">GNU Debugger(gdb)</a>一直是UNIX下最为流行的调试器，而在Cocoa框架中也一直被作为默认的调试工具。在gcc都被LLVM取代了的如今，gdb还是作为默认调试器，更可见其优秀特性。</p>




<p>最近在调试过程中发现了一些小窍门或者说是小技巧，不敢独飨。
		
		<a href="/2011/11/debug/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-11-20T00:00:00+09:00" data-updated="true" itemprop="datePublished">Nov 20<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/hu-yan-luan-yu-ji/'>胡言乱语集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/11/rest/" itemprop="url">难得的休假</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://www.onevcat.com/wp-content/uploads/2011/11/2905697_144150017_2.jpg"><img class="aligncenter size-full wp-image-304" title="2905697_144150017_2" src="http://www.onevcat.com/wp-content/uploads/2011/11/2905697_144150017_2-e1321800916975.jpg" alt="" width="1024" height="256" /></a>海南是个不错的地方，十多年前来就很不错，现在的话貌似也还行。难得能在这种忙得死人的时候能拿出三天时间跑到海南放松一下…刚做完一个会议报告就被大家围着提问，十分钟的演讲，提问居然持续了十五分钟，这不是明摆着坑我么&#8230;看来之前的准备还是过于浅显了。下次有这样的会议报告的话一定努力做得让大家看不懂才行。</p>




<p>讲完以后现在可以开始休息两天了～这半年来被各种杂务缠身，不过貌似现在已经习惯这样的忙碌生活了，突然有机会放松下来心里居然会有一些不安。而幸好，海南正好是一个能够让人轻松下来的地方，只要躲开白天的下饺子，选择半夜三点到海边吹风，在静谧的海滩上倾心聆听。深夜里视觉的丧失，能换来听觉的敏锐，由耳及心，去感受那一份独特的宽广和优雅，这样的体会在能看到喧闹的海浪的时候是永远体会不到的。</p>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-11-09T00:00:00+09:00" data-updated="true" itemprop="datePublished">Nov 9<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/neng-gong-qiao-jiang-ji/'>能工巧匠集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/11/objective-c%E4%B8%AD%E7%9A%84block/" itemprop="url">Objective-C中的Block</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><img src="http://www.onevcat.com/wp-content/uploads/2011/11/block1.png" alt="Block in Objective-c" /></p>

<p>技术是需要沉淀的。接触iOS开发也有大半年时间了，从一开始的纯白到现在自我感觉略懂一点，其实进步是明显的。无数牛人表示技术博是完成菜鸟到高手蜕变的途径之一，虽然这个博客并非是为技术而生，但是也许作为工科背景下的我来说，每天都写文艺的东西显然并不现实。于是就有了这个集子：能工巧匠集。用这篇开篇，</p>

<p>写一些在开发过程中的积累和感悟，大部分应该是Objectiv-C和XCode的内容，包括基本语法特性和小技巧，或者自己喜欢的一些开源代码的用法分析等等。也许以后会扩展到Unity3D或者UDK的一些3D引擎的心得，当然也有可能会有别的一些自己认为值得分享的东西。这个集子的目的，一来是记录自己一步一步成长的脚印，二来也算是为新来者铺一条直一点的道路。集子里的东西仅仅是自己的心得体会，高手路过请一笑置之..感恩。</p>

<p>iOS SDK 4.0开始，Apple引入了block这一特性，而自从block特性诞生之日起，似乎它就受到了Apple特殊的照顾和青睐。字面上说，block就是一个代码块，但是它的神奇之处在于在内联(inline)执行的时候(这和C++很像)还可以传递参数。同时block本身也可以被作为参数在方法和函数间传递，这就给予了block无限的可能。</p>

<p>在日常的coding里绝大时间里开发者会是各种block的使用者，但是当你需要构建一些比较基础的，提供给别人用的类的时候，使用block会给别人的使用带来很多便利。当然如果你已经厌烦了一直使用delegate模式来编程的话，偶尔转转写一些block，不仅可以锻炼思维，也能让你写的代码看起来高端洋气一些，而且因为代码跳转变少，所以可读性也会增加。</p>

<p>先来看一个简单的block吧：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// Defining a block variable</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="p">(</span><span class="o">^</span><span class="n">isInputEven</span><span class="p">)(</span><span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">int</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">input</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上定义了一个block变量，block本身就是一个程序段，因此有返回值有输入参数，这里这个block返回的类型为BOOL。天赋异秉的OC用了同样不走寻常路的&#8221;
^&#8221;符号来表示block定义的开始（就像用减号和加号来定义方法一样），block的名称紧跟在
^符号之后，这里是isInputEven（也即以后使用inline方式调用该block时所需要的名称）。这段block接受一个int型的参数，而在等号后面的int input是对这个传入int参数的说明：在该block内，将使用input这个名字来指代传入的int参数。一开始看block的定义和写法时可能会比较痛苦，但是请谨记它只是把我们常见的方法实现换了一种写法而已，请以习惯OC中括号发送消息的速度和决心，尽快习惯block的写法吧！</p>

<p>调用这个block的方法就非常简单和直观了，类似调用c函数的方式即可：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// Call similar to a C function call</span>
</span><span class='line'><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">101</span><span class="p">;</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d %@ number&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">isInputEven</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">?</span> <span class="s">@&quot;is an even&quot;</span> <span class="o">:</span> <span class="s">@&quot;is not an even&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>不出意外的话输出为<strong>-101 is not an even number</strong></p>

<p>以上的用法没有什么特别之处，只不过是类似内联函数罢了。但是block的神奇之处在于block外的变量可以无缝地直接在block内部使用，比如这样：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="mf">1.99</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="p">(</span><span class="o">^</span><span class="n">finalPrice</span><span class="p">)(</span><span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Notice local variable price is </span>
</span><span class='line'>  <span class="c1">// accessible in the block</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kt">int</span> <span class="n">orderQuantity</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Ordering %d units, final price is: $%2.2f&quot;</span><span class="p">,</span> <span class="n">orderQuantity</span><span class="p">,</span> <span class="n">finalPrice</span><span class="p">(</span><span class="n">orderQuantity</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出为<strong>Ordering 10 units, final price is: $19.90</strong></p>

<p>相当开心啊，block外的<code>price</code>成功地在block内部也能使用了，这意味着内联函数可以使用处于同一scope里的局部变量。但是需要注意的是，你不能在block内部改变本地变量的值，比如在
^{}里写<code>price = 0.99</code>这样的语句的话，你亲爱的compiler一定是会叫的。而更需要注意的是<code>price</code>这样的局部变量的变化是不会体现在block里的！比如接着上面的代码，继续写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">price</span> <span class="o">=</span> <span class="mf">.99</span><span class="p">;</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Ordering %d units, final price is: $%2.2f&quot;</span><span class="p">,</span> <span class="n">orderQuantity</span><span class="p">,</span> <span class="n">finalPrice</span><span class="p">(</span><span class="n">orderQuantity</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出还是<strong>Ordering 10 units, final price is: $19.90，</strong>这就比较忧伤了，可以理解为在block内的<code>price</code>是readonly的，只在定义block时能够被赋值（补充说明，实际上是因为<code>price</code>是value type，block内的<code>price</code>是在申明block时复制了一份到block内，block外面的<code>price</code>无论怎么变化都和block内的<code>price</code>无关了。如果是reference type的话，外部的变化实际上是会影响block内的）。</p>

<p>但是如果确实需要传递给block变量值的话，可以考虑下面两种方法：</p>

<p>1、将局部变量声明为<code>__block</code>，表示外部变化将会在block内进行同样操作，比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// Use the __block storage modifier to allow changes to &#39;price&#39;</span>
</span><span class='line'><span class="n">__block</span> <span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="mf">1.99</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="p">(</span><span class="o">^</span><span class="n">finalPrice</span><span class="p">)(</span><span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">orderQuantity</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'><span class="n">price</span> <span class="o">=</span> <span class="mf">.99</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;With block storage modifier - Ordering %d units, final price is: $%2.2f&quot;</span><span class="p">,</span> <span class="n">orderQuantity</span><span class="p">,</span> <span class="n">finalPrice</span><span class="p">(</span><span class="n">orderQuantity</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>此时输出为<strong>With block storage modifier – Ordering 10 units, final price is: $9.90</strong></p>

<p>2、使用实例变量——这个比较没什么好说的，实例内的变量横行于整个实例内..可谓霸道无敌&#8230;=_=</p>

<p>block外的对象和基本数据一样，也可以作为block的参数。而让人开心的是，block将自动retain传递进来的参数，而不需担心在block执行之前局部对象变量已经被释放的问题。这里就不深究这个问题了，只要严格遵循Apple的thread safe来写，block的内存管理并不存在问题。（更新，ARC的引入再次简化了这个问题，完全不用担心内存管理的问题了）</p>

<p>由于block的灵活的机制，导致iOS SDK 4.0开始，Apple大力提倡在各种地方应用block机制。最典型的当属UIView的动画了：在4.0前写一个UIView的Animation大概是这样的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">UIView</span> <span class="nl">beginAnimations:</span><span class="s">@&quot;ToggleSiblings&quot;</span><span class="nl">context:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationTransition:</span><span class="n">UIViewAnimationTransitionCurlUp</span> <span class="nl">forView:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">cache:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nl">UIViewsetAnimationDuration:</span><span class="mf">1.0f</span><span class="p">];</span>
</span><span class='line'><span class="c1">// Make your changes</span>
</span><span class='line'><span class="p">[</span><span class="n">UIView</span> <span class="n">commitAnimations</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>在一个不知名的小角落里的begin/commit两行代码间写下需要进行的动作，然后静待发生。而4.0后这样的方法直接被discouraged了(虽然还没Deprecated)，取而代之的正是block：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">UIView</span> <span class="nl">animateWithDuration:</span><span class="mf">5.0f</span> <span class="nl">animations:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>  <span class="n">view</span><span class="p">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>简单明了，一切就这么发生了..</p>

<p>可能有人会觉得block的语法很奇怪，不像是OOP的风格，诚然直接使用的block看起来破坏了OOP的结构，也让实例的内存管理出现了某些“看上去奇怪”的现象。但是通过<code>typedef</code>的方法，可以将block进行简单包装，让它的行为更靠近对象一些：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">typedef</span> <span class="nf">double</span> <span class="p">(</span><span class="o">^</span><span class="n">unary_operation_t</span><span class="p">)(</span><span class="kt">double</span> <span class="n">op</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>定义了一个接受一个double型作为变量，类型为unary_operation_t的block，之后在使用前用类似C的语法声明一个unary_operation_t类型的&#8221;实例&#8221;，并且定义内容后便可以直接使用这个block了～</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">unary_operation_t</span> <span class="n">square</span><span class="p">;</span>
</span><span class='line'><span class="n">square</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">double</span> <span class="n">operand</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">operand</span> <span class="o">*</span> <span class="n">operand</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><del>啰嗦一句的还是内存管理的问题，block始终不是对象，而block的内存管理自然也是和普通对象不一样。系统会为block在堆上分配内存，而当把block当做对象进行处理时（比如将其压入一个NSMutableArray），我们需要获取它的一份copy（比如[square copy]），并且在Array retain了这个block后将其释放（[square autorelease]是不错的选择）。而对于block本身和调用该block的实例，则可以放心：SDK会将调用block的实例自动retain，直至block执行完毕后再对实例release，因此不会出现block执行到一半，实例就被dealloc这样的尴尬的局面。</del> 在ARC的时代，这些都是废话了。打开ARC，然后瞎用就可以了。ARC解决了block的最让开发者头疼的最大的也是唯一的问题，内存管理。关于block的内存管理方面，有一个很好玩的小quiz，可以做做玩～<a href="http://blog.parse.com/2013/02/05/objective-c-blocks-quiz/">传送门</a></p>

<p>iOS SDK 4.0以后，随着block的加入很多特性也随之添加或者发生了升级。Apple所推荐的block使用范围包括以下几个方面：</p>

<ul>
<li>枚举——通过block获取枚举对象或控制枚举进程</li>
<li>View动画——简单明了的方式规定动画</li>
<li>排序——在block内写排序算法</li>
<li>通知——当某事件发生后执行block内的代码</li>
<li>错误处理——当错误发生时执行block代码</li>
<li>完成处理——当方法执行完毕后执行block代码</li>
<li>GCD多线程——多线程控制，关于这个以后有机会再写…</li>
</ul>


<p>仔细研读4.0的SDK的话，会发现很多常用类中都加入了不少带block作为参数的方法，改变固有思维习惯，适应并尽可能利用block给程序上带来的便捷，无疑是提高效率和使代码优雅的很好的途径～</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-31T00:00:00+09:00" data-updated="true" itemprop="datePublished">Oct 31<span>st</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/hu-yan-luan-yu-ji/'>胡言乱语集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/10/seeking-job/" itemprop="url">近期求职总结-AHRP和DeNA面试</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><!--:zh--><p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/10/111.jpg"><img class="aligncenter size-full wp-image-257" title="AHRP" src="http://www.onevcat.com/wp-content/uploads/2011/10/111-e1320070029815.jpg" alt="AHRP" width="940" height="256" /></a><em><span style="color: #ff0000;"><strong>AHRP2012秋季项目已经结束，春季项目博主可以以内定者的身份进行内推，具体可以参看<a href="http://www.onevcat.com/2012/01/ahrp2012/">这篇帖子</a>。</strong></span></em></p>
<p style="text-align: justify;">在求职路上已经走了一段时间了，一直不太顺利，趁现在有时间有心情稍微整理一下近期在求职中的感受，也算做一个阶段总结吧。</p>
<p style="text-align: justify;">其实一开始目标就比较明确了，不太想继续在做硕士期间的方向走下去，而是想做一些移动互联开发相关的事情，同时也看好智能电视和近距传输这样有可能在近期再一次改变人类生活的东西。所以简历大都扔到了IT公司。投出去的简历无非三种结果：第一是毫无回音的，比如支付宝；第二是通知笔试但是被我拒了，比如盛大；最后确实比较诱人的企业，比如网易腾讯之流，但是参加完笔试就毫无音讯——作为一个学IC的，要去和软院的孩子们比默写最短路径之类的无聊算法实在有些强人所难，以及无趣。<!--:--><!--:en--><p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/10/111.jpg"><img class="aligncenter size-full wp-image-257" title="AHRP" src="http://www.onevcat.com/wp-content/uploads/2011/10/111-e1320070029815.jpg" alt="AHRP" width="940" height="256" /></a>在求职路上已经走了一段时间了，一直不太顺利，趁现在有时间有心情稍微整理一下近期在求职中的感受，也算做一个阶段总结吧。</p>
<p style="text-align: justify;">其实一开始目标就比较明确了，不太想继续在做硕士期间的方向走下去，而是想做一些移动互联开发相关的事情，同时也看好智能电视和近距传输这样有可能在近期再一次改变人类生活的东西。所以简历大都扔到了IT公司。投出去的简历无非三种结果：第一是毫无回音的，比如支付宝；第二是通知笔试但是被我拒了，比如盛大；最后确实比较诱人的企业，比如网易腾讯之流，但是参加完笔试就毫无音讯——作为一个学IC的，要去和软院的孩子们比默写最短路径之类的无聊算法实在有些强人所难，以及无趣。<!--:--><!--:ja--><p style="text-align: justify;"><a href="http://www.onevcat.com/wp-content/uploads/2011/10/111.jpg"><img class="aligncenter size-full wp-image-257" title="AHRP" src="http://www.onevcat.com/wp-content/uploads/2011/10/111-e1320070029815.jpg" alt="AHRP" width="940" height="256" /></a>在求职路上已经走了一段时间了，一直不太顺利，趁现在有时间有心情稍微整理一下近期在求职中的感受，也算做一个阶段总结吧。</p>
<p style="text-align: justify;">其实一开始目标就比较明确了，不太想继续在做硕士期间的方向走下去，而是想做一些移动互联开发相关的事情，同时也看好智能电视和近距传输这样有可能在近期再一次改变人类生活的东西。所以简历大都扔到了IT公司。投出去的简历无非三种结果：第一是毫无回音的，比如支付宝；第二是通知笔试但是被我拒了，比如盛大；最后确实比较诱人的企业，比如网易腾讯之流，但是参加完笔试就毫无音讯——作为一个学IC的，要去和软院的孩子们比默写最短路径之类的无聊算法实在有些强人所难，以及无趣。<!--:-->
		
		<a href="/2011/10/seeking-job/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-27T00:00:00+09:00" data-updated="true" itemprop="datePublished">Oct 27<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/nan-ji-bei-dou-ji/'>南箕北斗集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/10/xcode4/" itemprop="url">XCode4.2，想说爱你不容易</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://www.onevcat.com/wp-content/uploads/2011/10/Xcode-1.jpg"><img class="aligncenter size-full wp-image-247" title="Xcode" src="http://www.onevcat.com/wp-content/uploads/2011/10/Xcode-1-e1319647071157.jpg" alt="" width="1096" height="254" /></a>随着iOS5，最终还是在一个项目结束之前就被迫换到XCode4.2了。XCode4初出的时候就有无数先辈惨死在无尽的bug和极度不适中，而我选择了在一段时间的4.1和3.2.6共存的过渡期后再完全转到新版本下继续工作，现在看来是非常明智的。</p>




<p>GCC在4.2彻底再见了，同样标着4.2，但是想在XCode4.2上弄个GCC4.2的编译器还真是费力。还好LLVM还不错，就是可怜了那些写了N多GCC only的stand-alone的苦逼程序员了。LLVM最终还是暴露了了Apple想要脱离GNU的目标，
		
		<a href="/2011/10/xcode4/" class="more-link">继续阅读</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-22T00:00:00+09:00" data-updated="true" itemprop="datePublished">Oct 22<span>nd</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/sui-sui-nian/'>碎碎念</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/10/%E6%B1%82%E8%81%8C%E4%B8%AD/" itemprop="url">求职中</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>努力求职中&#8230;一直被虐，仍需努力&#8230;</p>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-22T00:00:00+09:00" data-updated="true" itemprop="datePublished">Oct 22<span>nd</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/category/hu-yan-luan-yu-ji/'>胡言乱语集</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/2011/10/pandaria/" itemprop="url">潘达利亚，你好</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://www.onevcat.com/wp-content/uploads/2011/10/11.jpg"><img class="aligncenter size-full wp-image-240" title="MOP" src="http://www.onevcat.com/wp-content/uploads/2011/10/11.jpg" alt="" width="905" height="153" /></a>因为一直忙着找工作，最近对各种消息新闻的关注很少。早上起来难得有时间看看新闻，发现BlizzCon2011最终还是没有让人失望，一年一部的WOW资料片又被推上了前台。潘达利亚之雾(Mists of Pandaria)的背后，熊猫人最终还是被BLZ作为填充新作空白期的大菜呈递了出来。虽说整个WOW主线和熊猫人其实没有什么关系，但是作为War3的重要英雄之一，熊猫人的出现倒也还算是合情合理吧。
		
		<a href="/2011/10/pandaria/" class="more-link">继续阅读</a>
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/page/7/" class="prev">Prev</a>
    
    
        <a href="/page/9/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">全部文章</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
	<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/80x15.png" /></a>本站点采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh">知识共享署名-非商业性使用 3.0 国际版本许可协议</a>进行许可
</p>
<p>
  2014 - <a href="http://about.me/onevcat">@onevcat</a>  
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>  <span class="credit"> 感谢<a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a>为本站提供稳定的VPS服务</span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'onevcat';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-25719337-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
